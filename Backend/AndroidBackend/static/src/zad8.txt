W Build gradle nalezy dodac linijke:

compile 'com.squareup.retrofit:retrofit:+'


Tworzymy API które definiuje punkty dostępu do serwisu.

public interface JsonRatesService {

	@GET("/list/USD")
	RatesList getCurrencyTable();
}


W ListCurrenciesActivity w metodzie onCreate() konfigurujemy adapter serwisu.

Bedzie tez trzeba dodac zasob tekstowy o nazwie webservice_url i wartosci http://83.230.72.199:8086

RestAdapter restAdapter = new RestAdapter.Builder().
	setEndpoint(getString(R.string.webservice_url) + ":" + getString(R.string.webservice_port)).
	build();

service = restAdapter.create(JsonRatesService.class);


Niejawnie używamy biblioteki GSON do parsowania JSON.


Musimy jeszcze dodać pole:

private JsonRatesService service;


Oraz nowy zasób tekstowy:

<string name="webservice_port">8086</string>


Pobieranie z internet wywoływane musi być na osobnym wątku, inaczej rzucony zostanie NetworkOnMainThreadException. Dlatego oddelegujemy wywołanie operacji sieciowej do osobnego wątku. Zdefiniujemy wewnętrzną klasę rozszerzającą AsyncTask.

private class GetCurrencyTableTask extends AsyncTask<Void, Void, RatesList> {

	private final ProgressDialog dialog;

	public GetCurrencyTableTask(Context context) {
		dialog = new ProgressDialog(context);
		dialog.setMessage(getString(R.string.please_wait));
	}

	@Override
	protected void onPreExecute() {
		super.onPreExecute();
		dialog.show();
	}

	@Override
	protected RatesList doInBackground(Void... param) {
		return service.getCurrencyTable();
	}

	@Override
	protected void onPostExecute(RatesList currencies) {
		super.onPostExecute(currencies);
		dialog.dismiss();
		currencyListView.setAdapter(new CurrencyListAdapter(ListCurrenciesActivity.this, currencies));
	}
}


Dodajemy zasób tekstowy:

<string name="please_wait">Proszę czekać</string>


Dodajemy metodę:

private void loadData() {
	new GetCurrencyTableTask(this).execute();
}


Pozostaje w metodzie onCreate wywołać metodę loadData.

loadData();


Usuwamy dane testowe z metody onCreate:

CurrencyListAdapter adapter = new CurrencyListAdapter(this, MockData.getListOfRates());
currencyListView.setAdapter(adapter);